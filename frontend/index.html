<!-- save this as frontend/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Notes Summarizer Demo</title>
  <style>
    body { font-family: sans-serif; max-width: 700px; margin: 2rem auto; }
    section { margin-bottom: 2rem; padding: 1rem; border: 1px solid #ddd; border-radius: 4px; }
    textarea { width: 100%; height: 80px; }
    input, button { margin-top: .5rem; }
    pre { background: #f7f7f7; padding: .5rem; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>Notes Summarizer</h1>

  <section id="extract">
    <h2>1. Extract Text from PDF</h2>
    <input type="file" id="extract-file" accept=".pdf" />
    <button onclick="doExtract()">Extract</button>
    <pre id="extract-out">—</pre>
  </section>

  <section id="ingest">
    <h2>2. Ingest Plain Text</h2>
    <textarea id="ingest-text" placeholder="Paste some text…"></textarea><br/>
    <input id="ingest-cat" placeholder="Category (e.g. ‘notes’)"/><br/>
    <button onclick="doIngest()">Ingest</button>
    <pre id="ingest-out">—</pre>
  </section>

  <section id="search">
    <h2>3. Search</h2>
    <input id="search-q" placeholder="Query…"/>
    <input id="search-k" type="number" value="5" style="width:3em"/>
    <button onclick="doSearch()">Search</button>
    <pre id="search-out">—</pre>
  </section>

  <section id="summarize">
    <h2>4. Summarize / Q&A</h2>
    <textarea id="summarize-text" placeholder="Paste text or previous extraction…"></textarea><br/>
    <button onclick="doSummarize()">Summarize</button>
    <pre id="summarize-out">—</pre>
  </section>

  <script>
    const API = "http://127.0.0.1:8000/api";

    async function doExtract() {
      const fileInput = document.getElementById("extract-file");
      if (!fileInput.files.length) return alert("Pick a PDF first!");
      const fd = new FormData();
      fd.append("file", fileInput.files[0]);

      const res = await fetch(`${API}/extract/`, {
        method: "POST",
        body: fd
      });
      document.getElementById("extract-out").textContent =
        res.ok ? await res.text() : `Error: ${res.status}`;
    }

    async function doIngest() {
      const text = document.getElementById("ingest-text").value;
      const category = document.getElementById("ingest-cat").value;
      const res = await fetch(`${API}/ingest/`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text, category })
      });
      document.getElementById("ingest-out").textContent =
        res.ok ? JSON.stringify(await res.json(), null, 2)
               : `Error: ${res.status}`;
    }

    async function doSearch() {
      const q = encodeURIComponent(document.getElementById("search-q").value);
      const k = document.getElementById("search-k").value;
      const res = await fetch(`${API}/search/?query=${q}&top_k=${k}`);
      document.getElementById("search-out").textContent =
        res.ok ? JSON.stringify(await res.json(), null, 2)
               : `Error: ${res.status}`;
    }

    async function doSummarize() {
      const text = document.getElementById("summarize-text").value;
      const res = await fetch(`${API}/summarize/`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text })
      });
      document.getElementById("summarize-out").textContent =
        res.ok ? await res.text()
               : `Error: ${res.status}`;
    }
  </script>
</body>
</html>
